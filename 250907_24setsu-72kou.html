<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>二十四節気・七十二候ウィジェット</title>
  <style>
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI","Yu Gothic",Meiryo,sans-serif;
      display:grid; place-items:center;
      background:#0b1220; /* canvas edge in dark to blend */
    }
    .card{
      width:min(520px,94vw);
      border-radius:20px; padding:18px 20px; text-align:center;
      box-shadow:0 10px 28px rgba(0,0,0,.18), inset 0 0 0 1px rgba(255,255,255,.06);
      transition:background-color .2s ease, color .2s ease;
    }
    .dateRange{font-size:12px; letter-spacing:.08em; opacity:.9; margin-bottom:10px}
    .main-line1{font-size:clamp(20px,4.6vw,34px); font-weight:800; line-height:1.35}
    .main-line2{font-size:clamp(14px,3.5vw,20px); font-weight:600; opacity:.95}
  </style>
</head>
<body>
  <div class="card" id="card">
    <div class="dateRange" id="dateRange"></div>
    <div class="main-line1" id="line1"></div>
    <div class="main-line2" id="line2"></div>
  </div>

  <script>
    // ===== Utilities =====
    function getJSTParts(d){
      const fmt = new Intl.DateTimeFormat('ja-JP',{timeZone:'Asia/Tokyo',year:'numeric',month:'2-digit',day:'2-digit',weekday:'short'});
      const parts = fmt.formatToParts(d).reduce((o,p)=>(o[p.type]=p.value,o),{});
      return {y:+parts.year,m:+parts.month,d:+parts.day,wd:parts.weekday};
    }
    function mmdd(m,d){return m*100+d}
    function getTargetDate(){
      const qp=new URLSearchParams(location.search); const v=qp.get('date');
      if(v){const m=v.match(/^(\d{4})-(\d{2})-(\d{2})$/); if(m) return new Date(+m[1],+m[2]-1,+m[3]);}
      return new Date();
    }
    function setAdaptiveText(elBgHex){
      // Choose readable text color (black/white) based on relative luminance
      const hex=elBgHex.replace('#','');
      const r=parseInt(hex.slice(0,2),16)/255, g=parseInt(hex.slice(2,4),16)/255, b=parseInt(hex.slice(4,6),16)/255;
      const srgb=[r,g,b].map(c=> c<=0.03928? c/12.92 : Math.pow((c+0.055)/1.055,2.4));
      const L=0.2126*srgb[0]+0.7152*srgb[1]+0.0722*srgb[2];
      const useDarkText = L>0.6; // bright background → dark text
      return useDarkText? {fg:'#0f172a', sub:'#334155'} : {fg:'#f8fafc', sub:'#e5e7eb'};
    }

    // ===== Data: 72候（固定日ベースの簡易表） =====
    // Each item: {m,d, sekki, kou, yomi}
    const RAW = [
      {m:1,d:1,  sekki:'冬至', kou:'雪下出麦', yomi:'ゆきわたりてむぎのびる'},
      {m:1,d:5,  sekki:'小寒', kou:'芹始生',   yomi:'せりはじめてしょうず'},
      {m:1,d:10, sekki:'小寒', kou:'水泉動',   yomi:'すいせんうごく'},
      {m:1,d:15, sekki:'小寒', kou:'雉始雊',   yomi:'きじはじめてなく'},
      {m:1,d:20, sekki:'大寒', kou:'款冬華',   yomi:'ふきのはなさく'},
      {m:1,d:25, sekki:'大寒', kou:'水沢腹堅', yomi:'さわみずこおりつめる'},
      {m:1,d:30, sekki:'大寒', kou:'鶏始乳',   yomi:'にわとりはじめてとやにつく'},
      {m:2,d:4,  sekki:'立春', kou:'東風解凍', yomi:'はるかぜこおりをとく'},
      {m:2,d:9,  sekki:'立春', kou:'黄鶯睍睆', yomi:'うぐいすなく'},
      {m:2,d:14, sekki:'立春', kou:'魚上氷',   yomi:'うおこおりをいずる'},
      {m:2,d:19, sekki:'雨水', kou:'土脉潤起', yomi:'つちのしょううるおいおこる'},
      {m:2,d:24, sekki:'雨水', kou:'霞始靆',   yomi:'かすみはじめてたなびく'},
      {m:3,d:1,  sekki:'雨水', kou:'草木萠動', yomi:'そうもくめばえいずる'},
      {m:3,d:6,  sekki:'啓蟄', kou:'蟄虫啓戸', yomi:'すごもりのむしとをひらく'},
      {m:3,d:11, sekki:'啓蟄', kou:'桃始笑',   yomi:'ももはじめてさく'},
      {m:3,d:16, sekki:'啓蟄', kou:'菜虫化蝶', yomi:'なむしちょうとなる'},
      {m:3,d:21, sekki:'春分', kou:'雀始巣',   yomi:'すずめはじめてすくう'},
      {m:3,d:26, sekki:'春分', kou:'桜始開',   yomi:'さくらはじめてひらく'},
      {m:3,d:31, sekki:'春分', kou:'雷乃発声', yomi:'かみなりすなわちこえをはっす'},
      {m:4,d:5,  sekki:'清明', kou:'玄鳥至',   yomi:'つばめきたる'},
      {m:4,d:10, sekki:'清明', kou:'鴻雁北',   yomi:'こうがんかえる'},
      {m:4,d:15, sekki:'清明', kou:'虹始見',   yomi:'にじはじめてあらわる'},
      {m:4,d:20, sekki:'穀雨', kou:'葭始生',   yomi:'あしはじめてしょうず'},
      {m:4,d:25, sekki:'穀雨', kou:'霜止出苗', yomi:'しもやみてなえいずる'},
      {m:4,d:30, sekki:'穀雨', kou:'牡丹華',   yomi:'ぼたんはなさく'},
      {m:5,d:5,  sekki:'立夏', kou:'蛙始鳴',   yomi:'かわずはじめてなく'},
      {m:5,d:10, sekki:'立夏', kou:'蚯蚓出',   yomi:'みみずいずる'},
      {m:5,d:15, sekki:'立夏', kou:'竹笋生',   yomi:'たけのこしょうず'},
      {m:5,d:21, sekki:'小満', kou:'蚕起食桑', yomi:'かいこおきてくわをはむ'},
      {m:5,d:26, sekki:'小満', kou:'紅花栄',   yomi:'べにばなさかう'},
      {m:5,d:31, sekki:'小満', kou:'麦秋至',   yomi:'むぎのときいたる'},
      {m:6,d:6,  sekki:'芒種', kou:'螳螂生',   yomi:'かまきりしょうず'},
      {m:6,d:11, sekki:'芒種', kou:'腐草為蛍', yomi:'くされたるくさほたるとなる'},
      {m:6,d:16, sekki:'芒種', kou:'梅子黄',   yomi:'うめのみきばむ'},
      {m:6,d:21, sekki:'夏至', kou:'乃東枯',   yomi:'なつかれくさかるる'},
      {m:6,d:26, sekki:'夏至', kou:'菖蒲華',   yomi:'あやめはなさく'},
      {m:7,d:1,  sekki:'夏至', kou:'半夏生',   yomi:'はんげしょうず'},
      {m:7,d:7,  sekki:'小暑', kou:'温風至',   yomi:'あつかぜいたる'},
      {m:7,d:12, sekki:'小暑', kou:'蓮始開',   yomi:'はすはじめてひらく'},
      {m:7,d:17, sekki:'小暑', kou:'鷹乃学習', yomi:'たかすなわちがくしゅうす'},
      {m:7,d:23, sekki:'大暑', kou:'桐始結花', yomi:'きりはじめてはなをむすぶ'},
      {m:7,d:28, sekki:'大暑', kou:'土潤溽暑', yomi:'つちうるおいてむしあつし'},
      {m:8,d:2,  sekki:'大暑', kou:'大雨時行', yomi:'たいうときどきふる'},
      {m:8,d:8,  sekki:'立秋', kou:'涼風至',   yomi:'すずかぜいたる'},
      {m:8,d:13, sekki:'立秋', kou:'寒蝉鳴',   yomi:'ひぐらしなく'},
      {m:8,d:18, sekki:'立秋', kou:'蒙霧升降', yomi:'ふかききりまとう'},
      {m:8,d:23, sekki:'処暑', kou:'綿柎開',   yomi:'わたのはなしべひらく'},
      {m:8,d:28, sekki:'処暑', kou:'天地始粛', yomi:'てんちはじめてさむし'},
      {m:9,d:2,  sekki:'処暑', kou:'禾乃登',   yomi:'こくものすなわちみのる'},
      {m:9,d:8,  sekki:'白露', kou:'草露白',   yomi:'くさのつゆしろし'},
      {m:9,d:13, sekki:'白露', kou:'鶺鴒鳴',   yomi:'せきれいなく'},
      {m:9,d:18, sekki:'白露', kou:'玄鳥去',   yomi:'つばめさる'},
      {m:9,d:23, sekki:'秋分', kou:'雷乃収声', yomi:'かみなりすなわちこえをおさむ'},
      {m:9,d:28, sekki:'秋分', kou:'蟄虫坏戸', yomi:'むしかくれてとをふさぐ'},
      {m:10,d:3, sekki:'秋分', kou:'水始涸',   yomi:'みずはじめてかる'},
      {m:10,d:8, sekki:'寒露', kou:'鴻雁来',   yomi:'こうがんきたる'},
      {m:10,d:13,sekki:'寒露', kou:'菊始開',   yomi:'きくはじめてひらく'},
      {m:10,d:18,sekki:'寒露', kou:'蟋蟀在戸', yomi:'きりぎりすとにあり'},
      {m:10,d:23,sekki:'霜降', kou:'霜始降',   yomi:'しもはじめてふる'},
      {m:10,d:28,sekki:'霜降', kou:'霎時施',   yomi:'こさめときどきふる'},
      {m:11,d:2, sekki:'霜降', kou:'楓蔦黄',   yomi:'もみじつたきばむ'},
      {m:11,d:7, sekki:'立冬', kou:'山茶始開', yomi:'つばきはじめてひらく'},
      {m:11,d:12,sekki:'立冬', kou:'地始凍',   yomi:'ちはじめてこおる'},
      {m:11,d:17,sekki:'立冬', kou:'金盞香',   yomi:'きんせんかさく'},
      {m:11,d:22,sekki:'小雪', kou:'虹蔵不見', yomi:'にじかくれてみえず'},
      {m:11,d:27,sekki:'小雪', kou:'朔風払葉', yomi:'きたかぜこのはをはらう'},
      {m:12,d:2, sekki:'小雪', kou:'橘始黄',   yomi:'たちばなはじめてきばむ'},
      {m:12,d:7, sekki:'大雪', kou:'閉塞成冬', yomi:'そらさむくふゆとなる'},
      {m:12,d:12,sekki:'大雪', kou:'熊蟄穴',   yomi:'くまあなにこもる'},
      {m:12,d:17,sekki:'大雪', kou:'鮭魚群',   yomi:'さけむらがる'},
      {m:12,d:22,sekki:'冬至', kou:'乃東生',   yomi:'なつかれくさしょうず'},
      {m:12,d:27,sekki:'冬至', kou:'麋角解',   yomi:'おおじかつのおつる'}
    ].sort((a,b)=>mmdd(a.m,a.d)-mmdd(b.m,b.d));

    // ===== 和色パレット（各節気×3候） =====
    // 柔らかいトーンで季節推移を表現。色名は参考（近似色）。
    const SEK_COLORS = {
      '立春':[ '#fde2e4', /*桜色*/ '#e7f2d9', /*若菜色*/ '#d9eef7' /*浅葱鼠*/ ],
      '雨水':[ '#e7f5ff' /*薄空*/ ,'#eaf3f0' /*薄翡翠*/ ,'#e3f0d4' /*若芽色*/ ],
      '啓蟄':[ '#eff7d3' /*若草*/ ,'#f6f0da' /*卵色*/ ,'#ffe7d1' /*杏色*/ ],
      '春分':[ '#f7e8ef' /*薄紅梅*/ ,'#f5f2da' /*生成り*/ ,'#e8f3ff' /*白群*/ ],
      '清明':[ '#e6f7f4' /*浅緑青*/ ,'#e7f0ff' /*露草色*/ ,'#f0f7e1' /*若緑*/ ],
      '穀雨':[ '#f6efe2' /*鳥の子色*/ ,'#eaf2d8' /*若竹色*/ ,'#f2e6ef' /*紅藤色*/ ],
      '立夏':[ '#ecffd9' /*薄萌黄*/ ,'#f4f7d0' /*若菜*/ ,'#fff1d6' /*卵色*/ ],
      '小満':[ '#fef3d9' /*刈安*/ ,'#fde1e1' /*撫子*/ ,'#e2f3e8' /*薄緑*/ ],
      '芒種':[ '#f9f0d2' /*淡香*/ ,'#f0f7e7' /*柳色*/ ,'#fff0e1' /*薄柿*/ ],
      '夏至':[ '#e2f1ff' /*空色*/ ,'#e0f7f3' /*浅縹*/ ,'#fff2d5' /*白玉子*/ ],
      '小暑':[ '#fff0d6' /*乳白色*/ ,'#ffe6cc' /*薄卵色*/ ,'#f9e2dc' /*薄珊瑚*/ ],
      '大暑':[ '#ffe9a8' /*浅黄*/ ,'#ffd8b5' /*薄橙*/ ,'#ffe3df' /*桜鼠*/ ],
      '立秋':[ '#f0efe3' /*薄鈍色*/ ,'#e6f1ee' /*薄青磁*/ ,'#f3e5d8' /*枯色*/ ],
      '処暑':[ '#f3e7c7' /*稲穂色*/ ,'#e4eddc' /*白緑*/ ,'#f1e4b8' /*籾色*/ ],
      '白露':[ '#e7f0f6' /*白群*/ ,'#e9eef2' /*薄鼠*/ ,'#dae7ef' /*薄花色*/ ],
      '秋分':[ '#efe7d9' /*砥粉色*/ ,'#f0e2cf' /*胡桃*/ ,'#e7dacf' /*小豆色淡*/ ],
      '寒露':[ '#e4edf6' /*薄縹*/ ,'#e8e3f5' /*藤色淡*/ ,'#dfe8f1' /*薄藍*/ ],
      '霜降':[ '#eeeae2' /*砂色*/ ,'#e1e6ed' /*薄勝色*/ ,'#ede3de' /*灰桜*/ ],
      '立冬':[ '#f1e6ec' /*薄紅藤*/ ,'#e9eef7' /*白藍*/ ,'#e6e3ef' /*薄藤鼠*/ ],
      '小雪':[ '#edf3f7' /*薄浅葱*/ ,'#f3efe8' /*象牙色*/ ,'#e7eaf2' /*薄縹鼠*/ ],
      '大雪':[ '#e9f0f4' /*薄青*/ ,'#e6edf2' /*白群*/ ,'#e8e6ea' /*薄墨*/ ],
      '冬至':[ '#e7f0ea' /*若緑淡*/ ,'#e5edf4' /*薄花桜*/ ,'#f0e9f2' /*淡藤*/ ],
      '小寒':[ '#e8eef5' /*薄群青*/ ,'#e9f2f2' /*白群淡*/ ,'#eef1f5' /*白鼠*/ ],
      '大寒':[ '#e7edf2' /*薄鼠*/ ,'#e6eef7' /*薄藍白*/ ,'#eceff1' /*白銀*/ ],
    };

    // attach colors to RAW by order within same sekki
    const counts={};
    const MS = RAW.map(item=>{
      const i = (counts[item.sekki]||0); counts[item.sekki]=i+1;
      const palette = SEK_COLORS[item.sekki]||['#f5f5f5','#ededed','#e5e5e5'];
      const color = palette[Math.min(i, palette.length-1)];
      return {...item, color};
    });

    function findMicroSeason(m,d){
      const key=mmdd(m,d);
      let idx=-1; for(let i=0;i<MS.length;i++){ if(mmdd(MS[i].m,MS[i].d)<=key) idx=i; else break; }
      if(idx===-1) idx=MS.length-1;
      const cur=MS[idx]; const next=MS[(idx+1)%MS.length];
      function toStr(m,d){return `${String(m).padStart(2,'0')}/${String(d).padStart(2,'0')}`}
      const endd=(next.d===1&&next.m===1)?0:next.d-1;
      return {...cur,startStr:toStr(cur.m,cur.d),endStr:toStr(next.m,endd)};
    }

    // ===== Render =====
    (function(){
      const target=getTargetDate();
      const {y,m,d,wd}=getJSTParts(target);
      const ms=findMicroSeason(m,d);
      const card=document.getElementById('card');
      card.style.background=ms.color;
      const {fg,sub}=setAdaptiveText(ms.color);
      card.style.color=fg;
      document.getElementById('dateRange').style.color=sub;
      document.getElementById('line2').style.color=sub;

      document.getElementById('line1').textContent = `${ms.sekki}　${ms.kou}`;
      document.getElementById('line2').textContent = `（${ms.yomi}）`;
      document.getElementById('dateRange').textContent = `${y}/${String(m).padStart(2,'0')}/${String(d).padStart(2,'0')} (${wd})　目安: ${ms.startStr} 〜 ${ms.endStr}`;
    })();
  </script>
</body>
</html>
