<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>二十四節気・七十二候ウィジェット</title>
  <style>
    :root{
      --fg:#0f172a; /* slate-900 */
      --sub:#334155; /* slate-700 */
      --bg:#ffffff;
      --card:#f8fafc; /* slate-50 */
      --ring:#e2e8f0; /* slate-200 */
    }
    @media (prefers-color-scheme: dark){
      :root{
        --fg:#e5e7eb; /* gray-200 */
        --sub:#cbd5e1; /* slate-300 */
        --bg:#0b1220; /* deep */
        --card:#111827; /* gray-900 */
        --ring:#1f2937; /* gray-800 */
      }
    }
    html,body{height:100%;}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI","Yu Gothic",Meiryo,sans-serif; 
      background:var(--bg); color:var(--fg);
      display:grid; place-items:center;
    }
    .card{
      width:min(560px, 94vw);
      border:1px solid var(--ring);
      background:var(--card);
      border-radius:16px; padding:20px 22px;
      box-shadow:0 8px 24px rgba(0,0,0,.06);
    }
    .date{font-size:12px; letter-spacing:.08em; color:var(--sub); margin-bottom:6px}
    .main{font-size:clamp(20px, 4.8vw, 36px); font-weight:700; line-height:1.35}
    .yomi{font-weight:500; font-size:.9em; color:var(--sub)}
    .sekki{padding:.1em .5em; border:1px solid var(--ring); border-radius:999px; font-weight:700; margin-right:.35em;}
    .sub{margin-top:6px; font-size:13px; color:var(--sub)}
  </style>
</head>
<body>
  <div class="card">
    <div class="date" id="date"></div>
    <div class="main"><span class="sekki" id="sekki"></span><span id="kou"></span> <span class="yomi" id="yomi"></span></div>
    <div class="sub" id="range"></div>
  </div>

  <script>
    // --- Helpers for JST date handling ---
    function getJSTParts(d){
      const fmt = new Intl.DateTimeFormat('ja-JP', { timeZone:'Asia/Tokyo', year:'numeric', month:'2-digit', day:'2-digit', weekday:'short'});
      const parts = fmt.formatToParts(d).reduce((o,p)=> (o[p.type]=p.value, o), {});
      return { y:+parts.year, m:+parts.month, d:+parts.day, wd:parts.weekday };
    }
    function ymdToDate(y,m,d){
      // Construct in local then correct via toLocaleString — not needed; we only ever compare mmdd numerically
      return new Date(y, m-1, d);
    }
    function mmdd(m,d){ return m*100 + d; }

    // Query param override for testing: ?date=YYYY-MM-DD
    function getTargetDate(){
      const qp = new URLSearchParams(location.search);
      const v = qp.get('date');
      if(v){
        const m = v.match(/^(\d{4})-(\d{2})-(\d{2})$/);
        if(m){ return new Date(+m[1], +m[2]-1, +m[3]); }
      }
      return new Date();
    }

    // --- Data: 72 micro-seasons (start dates are fixed approximation; may vary by year by ±1日程度) ---
    // Format: { m:MM, d:DD, sekki:"…", kou:"…", yomi:"…" }
    const MS = [
      // 冬至（三候3）→ 小寒 → 大寒 → 立春 … の順で年頭へ継ぎ目
      {m:1,d:1,  sekki:'冬至', kou:'雪下出麦', yomi:'ゆきわたりてむぎのびる'},
      {m:1,d:5,  sekki:'小寒', kou:'芹始生',   yomi:'せりはじめてしょうず'},
      {m:1,d:10, sekki:'小寒', kou:'水泉動',   yomi:'すいせんうごく'},
      {m:1,d:15, sekki:'小寒', kou:'雉始雊',   yomi:'きじはじめてなく'},
      {m:1,d:20, sekki:'大寒', kou:'款冬華',   yomi:'ふきのはなさく'},
      {m:1,d:25, sekki:'大寒', kou:'水沢腹堅', yomi:'さわみずこおりつめる'},
      {m:1,d:30, sekki:'大寒', kou:'鶏始乳',   yomi:'にわとりはじめてとやにつく'},
      {m:2,d:4,  sekki:'立春', kou:'東風解凍', yomi:'はるかぜこおりをとく'},
      {m:2,d:9,  sekki:'立春', kou:'黄鶯睍睆', yomi:'うぐいすなく'},
      {m:2,d:14, sekki:'立春', kou:'魚上氷',   yomi:'うおこおりをいずる'},
      {m:2,d:19, sekki:'雨水', kou:'土脉潤起', yomi:'つちのしょううるおいおこる'},
      {m:2,d:24, sekki:'雨水', kou:'霞始靆',   yomi:'かすみはじめてたなびく'},
      {m:3,d:1,  sekki:'雨水', kou:'草木萠動', yomi:'そうもくめばえいずる'},
      {m:3,d:6,  sekki:'啓蟄', kou:'蟄虫啓戸', yomi:'すごもりのむしとをひらく'},
      {m:3,d:11, sekki:'啓蟄', kou:'桃始笑',   yomi:'ももはじめてさく'},
      {m:3,d:16, sekki:'啓蟄', kou:'菜虫化蝶', yomi:'なむしちょうとなる'},
      {m:3,d:21, sekki:'春分', kou:'雀始巣',   yomi:'すずめはじめてすくう'},
      {m:3,d:26, sekki:'春分', kou:'桜始開',   yomi:'さくらはじめてひらく'},
      {m:3,d:31, sekki:'春分', kou:'雷乃発声', yomi:'かみなりすなわちこえをはっす'},
      {m:4,d:5,  sekki:'清明', kou:'玄鳥至',   yomi:'つばめきたる'},
      {m:4,d:10, sekki:'清明', kou:'鴻雁北',   yomi:'こうがんかえる'},
      {m:4,d:15, sekki:'清明', kou:'虹始見',   yomi:'にじはじめてあらわる'},
      {m:4,d:20, sekki:'穀雨', kou:'葭始生',   yomi:'あしはじめてしょうず'},
      {m:4,d:25, sekki:'穀雨', kou:'霜止出苗', yomi:'しもやみてなえいずる'},
      {m:4,d:30, sekki:'穀雨', kou:'牡丹華',   yomi:'ぼたんはなさく'},
      {m:5,d:5,  sekki:'立夏', kou:'蛙始鳴',   yomi:'かわずはじめてなく'},
      {m:5,d:10, sekki:'立夏', kou:'蚯蚓出',   yomi:'みみずいずる'},
      {m:5,d:15, sekki:'立夏', kou:'竹笋生',   yomi:'たけのこしょうず'},
      {m:5,d:21, sekki:'小満', kou:'蚕起食桑', yomi:'かいこおきてくわをはむ'},
      {m:5,d:26, sekki:'小満', kou:'紅花栄',   yomi:'べにばなさかう'},
      {m:5,d:31, sekki:'小満', kou:'麦秋至',   yomi:'むぎのときいたる'},
      {m:6,d:6,  sekki:'芒種', kou:'螳螂生',   yomi:'かまきりしょうず'},
      {m:6,d:11, sekki:'芒種', kou:'腐草為蛍', yomi:'くされたるくさほたるとなる'},
      {m:6,d:16, sekki:'芒種', kou:'梅子黄',   yomi:'うめのみきばむ'},
      {m:6,d:21, sekki:'夏至', kou:'乃東枯',   yomi:'なつかれくさかるる'},
      {m:6,d:26, sekki:'夏至', kou:'菖蒲華',   yomi:'あやめはなさく'},
      {m:7,d:1,  sekki:'夏至', kou:'半夏生',   yomi:'はんげしょうず'},
      {m:7,d:7,  sekki:'小暑', kou:'温風至',   yomi:'あつかぜいたる'},
      {m:7,d:12, sekki:'小暑', kou:'蓮始開',   yomi:'はすはじめてひらく'},
      {m:7,d:17, sekki:'小暑', kou:'鷹乃学習', yomi:'たかすなわちがくしゅうす'},
      {m:7,d:23, sekki:'大暑', kou:'桐始結花', yomi:'きりはじめてはなをむすぶ'},
      {m:7,d:28, sekki:'大暑', kou:'土潤溽暑', yomi:'つちうるおいてむしあつし'},
      {m:8,d:2,  sekki:'大暑', kou:'大雨時行', yomi:'たいうときどきふる'},
      {m:8,d:8,  sekki:'立秋', kou:'涼風至',   yomi:'すずかぜいたる'},
      {m:8,d:13, sekki:'立秋', kou:'寒蝉鳴',   yomi:'ひぐらしなく'},
      {m:8,d:18, sekki:'立秋', kou:'蒙霧升降', yomi:'ふかききりまとう'},
      {m:8,d:23, sekki:'処暑', kou:'綿柎開',   yomi:'わたのはなしべひらく'},
      {m:8,d:28, sekki:'処暑', kou:'天地始粛', yomi:'てんちはじめてさむし'},
      {m:9,d:2,  sekki:'処暑', kou:'禾乃登',   yomi:'こくものすなわちみのる'},
      {m:9,d:8,  sekki:'白露', kou:'草露白',   yomi:'くさのつゆしろし'},
      {m:9,d:13, sekki:'白露', kou:'鶺鴒鳴',   yomi:'せきれいなく'},
      {m:9,d:18, sekki:'白露', kou:'玄鳥去',   yomi:'つばめさる'},
      {m:9,d:23, sekki:'秋分', kou:'雷乃収声', yomi:'かみなりすなわちこえをおさむ'},
      {m:9,d:28, sekki:'秋分', kou:'蟄虫坏戸', yomi:'むしかくれてとをふさぐ'},
      {m:10,d:3, sekki:'秋分', kou:'水始涸',   yomi:'みずはじめてかる'},
      {m:10,d:8, sekki:'寒露', kou:'鴻雁来',   yomi:'こうがんきたる'},
      {m:10,d:13,sekki:'寒露', kou:'菊始開',   yomi:'きくはじめてひらく'},
      {m:10,d:18,sekki:'寒露', kou:'蟋蟀在戸', yomi:'きりぎりすとにあり'},
      {m:10,d:23,sekki:'霜降', kou:'霜始降',   yomi:'しもはじめてふる'},
      {m:10,d:28,sekki:'霜降', kou:'霎時施',   yomi:'こさめときどきふる'},
      {m:11,d:2, sekki:'霜降', kou:'楓蔦黄',   yomi:'もみじつたきばむ'},
      {m:11,d:7, sekki:'立冬', kou:'山茶始開', yomi:'つばきはじめてひらく'},
      {m:11,d:12,sekki:'立冬', kou:'地始凍',   yomi:'ちはじめてこおる'},
      {m:11,d:17,sekki:'立冬', kou:'金盞香',   yomi:'きんせんかさく'},
      {m:11,d:22,sekki:'小雪', kou:'虹蔵不見', yomi:'にじかくれてみえず'},
      {m:11,d:27,sekki:'小雪', kou:'朔風払葉', yomi:'きたかぜこのはをはらう'},
      {m:12,d:2, sekki:'小雪', kou:'橘始黄',   yomi:'たちばなはじめてきばむ'},
      {m:12,d:7, sekki:'大雪', kou:'閉塞成冬', yomi:'そらさむくふゆとなる'},
      {m:12,d:12,sekki:'大雪', kou:'熊蟄穴',   yomi:'くまあなにこもる'},
      {m:12,d:17,sekki:'大雪', kou:'鮭魚群',   yomi:'さけむらがる'},
      {m:12,d:22,sekki:'冬至', kou:'乃東生',   yomi:'なつかれくさしょうず'},
      {m:12,d:27,sekki:'冬至', kou:'麋角解',   yomi:'おおじかつのおつる'}
    ].sort((a,b)=> mmdd(a.m,a.d)-mmdd(b.m,b.d));

    function findMicroSeason(m, d){
      const key = mmdd(m,d);
      // find the last entry whose start <= today
      let idx = -1;
      for(let i=0;i<MS.length;i++){
        if(mmdd(MS[i].m, MS[i].d) <= key) idx = i; else break;
      }
      if(idx === -1){
        // earlier than Jan 1 micro-season start → use last of previous year (12/27)
        idx = MS.length - 1;
      }
      const cur = MS[idx];
      // end date is the day before the next start
      const next = MS[(idx+1)%MS.length];
      const y = new Date().getFullYear();
      function toStr(m,d){return `${String(m).padStart(2,'0')}/${String(d).padStart(2,'0')}`}
      return {
        ...cur,
        startStr: toStr(cur.m, cur.d),
        endStr: toStr(next.m, next.d === 1 && next.m === 1 ? 0 : next.d - 1) // rough label only
      };
    }

    // Render
    (function(){
      const target = getTargetDate();
      const {y,m,d,wd} = getJSTParts(target);
      const ms = findMicroSeason(m,d);

      // Date label
      const dateEl = document.getElementById('date');
      dateEl.textContent = `${y}/${String(m).padStart(2,'0')}/${String(d).padStart(2,'0')} (${wd})`;

      // Main
      document.getElementById('sekki').textContent = ms.sekki;
      document.getElementById('kou').textContent = ms.kou;
      document.getElementById('yomi').textContent = `（${ms.yomi}）`;

      // Range (informational)
      document.getElementById('range').textContent = `目安: ${ms.startStr} 〜 ${ms.endStr}`;
    })();
  </script>
</body>
</html>
